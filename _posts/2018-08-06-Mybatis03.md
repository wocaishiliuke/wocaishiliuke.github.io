---
title: Mybatis全局配置
date: 2018-08-06 20:01:09
categories:
    - Mybatis
tags:
    - Mybatis
    - Basic
    - Java
---

MyBatis的全局配置文件包含了会深深影响MyBatis行为的设置（settings）和属性（properties）信息

<!-- more -->

##### 目录

> 全局配置中标签有严格的顺序，受DTD约束

+ I.properties
+ II.settings
+ III.typeAliases
+ IV.typeHandlers
+ V.objectFactory
+ VI.plugins

---

# I.properties

- 1.既可以读取properties属性文件，亦可通过properties元素的子元素来定义
- 2.读取properties文件时，一般用resource属性，不用url(绝对路径)
- 3.也可以使用java配置的方式，利用Properties对象设置

```
SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, props);
SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, environment, props);
```

- 4.mybatis读取属性的先后顺序：properties标签中定义的 > resource或url读取的外部文件 > 作为方法参数传递props（后读取的会覆盖先加载的重名属性）
- 5.在3.4.2版本以后可以开启和指定默认值，也可以自定义默认值的分隔符

> jdbc.properties

```
driver=com.mysql.jdbc.Driver
url=jdbc:mysql://localhost:3306/test
#username=root
#password=root
```

> mybatis-config.xml

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!-- 属性配置 -->
    <properties resource="jdbc.properties">
        <property name="password" value="root"/>
        <!-- 开启指定默认值功能 -->
        <property name="org.apache.ibatis.parsing.PropertyParser.enable-default-value" value="true"/>
        <!-- 指定默认值的分隔符（默认是:） -->
        <property name="org.apache.ibatis.parsing.PropertyParser.default-value-separator" value="?:"/>
    </properties>
    
    <!-- 环境配置 -->
    <environments default="development">
        <environment id="development">
            <!-- 配置事务管理器 + 数据源 -->
            <transactionManager type="JDBC" />
            <dataSource type="POOLED">
                <property name="driver" value="${driver}" />
                <property name="url" value="${url}" />
                <property name="username" value="${username?:root}" />
                <property name="password" value="${password}" />
            </dataSource>
        </environment>
    </environments>
    
    <!-- 引入映射文件 -->
    <mappers>
        <mapper resource="UserMapper.xml" />
    </mappers>
</configuration>
```


# II.settings

> 调整settings中的设置是非常关键的，因为会改变MyBatis的运行时行为。其参数很多，这里只列举几个，详见[官网说明](http://www.mybatis.org/mybatis-3/zh/configuration.html#settings)

|设置参数 |描述 |有效值 |默认值 |
|:-------|:---|:-----|:-----|
|cacheEnabled |该配置影响的所有映射器中配置的缓存的全局开关 |true/false |true | 
|lazyLoadingEnabled |延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。特定关联关系中可通过设置fetchType属性来覆盖该项的开关状态。|true/false|false| 
|aggressiveLazyLoading |当启用时，带有延迟加载属性的对象的加载与否完全取决于对任意延迟属性的调用；反之，每种属性将会按需加载。|true/false |false（true in ≤3.4.1）|
|mapUnderscoreToCamelCase |是否开启自动驼峰命名规则（camel case）映射，即从经典数据库列名A_COLUMN到经典Java属性名aColumn的类似映射 |true/false |False |

# III.typeAliases

- 1.类型别名是Java类的短名字。它只和XML配置有关，存在的意义仅在于用来减少类完全限定名的冗余
- 2.可以单独配置，也可以使用包扫描的方式。扫描到的包下的所有类，别名就是类名首字母小写。但使用时不区分大小写，一般习惯和类名保持一致（首字母大写）。
- 3.也可以在Java Bean上使用@Alias("user")注解来指定
- 4.当然配置类别名后，全路径名依然能用
- 5.Mybatis为常见的Java类内建了别名，都是大小写不敏感的。需要注意的是由基本类型名称重复导致的特殊处理(如_int)，[参考官网](http://www.mybatis.org/mybatis-3/zh/configuration.html#typeAliases)

# IV.typeHandlers

- 1.MyBatis在预处理语句（PreparedStatement）中设置参数时，或从结果集中取值时，都会使用类型处理器进行Java类型和数据库类型间的转换
- 2.MyBatis自带的类型处理器基本够用，如果需要改变或自定义TypeHandler，可[参考官网](http://www.mybatis.org/mybatis-3/zh/configuration.html#typeHandlers)

# V.objectFactory

- [参考官网](http://www.mybatis.org/mybatis-3/zh/configuration.html#objectFactory)

# VI.plugins

- MyBatis允许在已映射到的语句执行过程中的某一点进行拦截调用。默认情况下，MyBatis允许使用插件来拦截的方法调用。包括：

>- Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)
>- ParameterHandler (getParameterObject, setParameters)
>- ResultSetHandler (handleResultSets, handleOutputParameters)
>- StatementHandler (prepare, parameterize, batch, update, query)

- 即mybatis支持在上述方法中进行拦截，可以自定义拦截器（插件），示例[参考官网](http://www.mybatis.org/mybatis-3/zh/configuration.html#plugins)