---
title: Jenkins入门
date: 2018-07-01 19:01:09
categories:
    - Jenkins
tags:
    - Jenkins
    - Basic
    - Devops
---

Jenkins是一款优秀的、基于Java的、开源、持续集成、交付和自动化测试工具。本文将介绍Jenkins的基本使用。

<!-- more -->

##### 目录
+ I.安装
+ II.部署准备
+ III.快速入门
+ IV.核心知识
+ V.创建Maven web项目
+ VI.参考

---

# I.安装

#### 1.下载

- [官方下载](https://jenkins.io/download/)

> 这里使用Generic Java package（.war）版本，可以使用java命令直接启动，绿色方便

#### 2.启动

```
java -jar jenkins.war --httpPort=8090
```

#### 3.初始化

- 1.在浏览器中访问localhost:8090
- 2.第一次访问会验证管理员初始化密码。可在控制台或给定的文件中获取
- 3.在Customize Jenkins页，使用推荐的插件安装即可
- 4.创建管理员Admin账号

#### 4.其他插件

> Jenkins功能有限，扩展功能就需要通过安装插件来实现。除初始化中推荐的插件外，这里再安装几个：

- 1.rebuilder：方便重新构建，减少重新构建时参数的输入
- 2.Safe Restart：方便重启Jenkins

> 在Manage Jenkins-->Manage Plugins-->Available中完成安装

#### 5.基础配置

> 默认的安全性配置是，Logged-in users can do anything，有一定的危险性。下面进行安全性配置

- 在Configure Global Security的Authorization中选择Matrix-based security安全矩阵模式
- 首先添加管理员Admin账号拥有所有权限
- 在Manage Users中，添加一个用户user1
- 再回到Configure Global Security的Authorization中，对user1赋予除Administer角色以外的全部权限即可
- 使用user1登录，看不到Manage Jenkins（系统管理）的菜单项时，即配置成功

---

# II.部署准备

> Jenkins服务和应用服务一般位于不同的主机上。这里为了方便本地测试，使用同一台Ubuntu 16.04LTS主机，且应用服务器需要确认一下事宜：

#### 1.应用服务器配置

- 1.IP地址

```
ifconfig
```

- 2.可以ssh远程访问，即安装了SSH server（Ubuntu已经默认安装了OpenSSH client），[安装可参考](https://www.jianshu.com/p/e666af148952)

- 3.登录账号和密码（如root用户）

> 一般服务器的SSH Server设置中PermitRootLogin=prohibit-password，即允许root用户远程登录，但不能使用密码登录，需要使用秘钥登录（如AWS）。当然可以使用ssh-keygen生成密钥对，再将公钥放置在服务器上。这里简单期间设置PermitRootLogin=yes即允许root用户远程登录，且可以使用密码

```
sudo vim /etc/ssh/sshd_config
service ssh restart
```


- 4.为了方便调试，且测试服务器基本都是内网，所以关闭防火墙。可参考[Ubuntu防火墙](https://www.jianshu.com/p/e666af148952)
- 5.Java安装和环境变量配置

```
java -version
```

- 6.Git安装及配置、公钥秘钥生成、github配置共钥

```
git --version
git config --list
```

- 7.Maven安装和mvn环境变量配置

```
mvn --version
```

- 8.Tomcat安装和配置

#### 2. 配置服务器Node

> 在Jenkins上配置应用服务器节点，并使用一个简单的任务进行测试

- 2.1 配置Node

> - 1.Manage Nodes-->New Node-->输入节点名，选择Permanent Agent-->
> - 2.配置Jenkins是的远程工作目录Remote root directory，如/root/jenkins-->登录方式Launch method选择Launch slave agents via SSH-->
> - 3.Host填写应用服务器的IP-->添加一个Credentials（Username+Password），并选中刚添加的登录用户（如果上面选择的远程工作目录需要root权限，这里就要求是root用户）-->保存完成
> - 4.测试连接launch agent（之前配置了root可远程密码登录）

> 第一次使用root用户连接服务器时，可能客户端的known_hosts中还没有链接的服务器信息，会报错连接不上，使用终端先连接一下即可

```
ssh root@192.168.0.44
The authenticity of host '192.168.0.44 (192.168.0.44)' can't be established.
ECDSA key fingerprint is SHA256:CAeHEh8XpsBhRa6XERytQTCIFofm+74Z9fjGKNjVvl8.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.0.44' (ECDSA) to the list of known hosts.
```

- 2.2 测试任务

> - 1.New Item-->输入任务名TestTask，选择FreeStyle project
> - 2.在General中勾选Restrict where this project can be run，输入执行的目标Node（刚才创建的服务器节点）
> - 3.在build中选择Execute shell-->在命令行中输入测试命令：ifconfig，保存即可
> - 4.点击build now立即执行，在build history中查看构建的Console Output

#### 3.