---
title: 字节流
date: 2018-01-21 00:00:00
categories:
    - JavaSE
tags:
    - JavaSE
---

本文讲述字节流的相关内容。

<!-- more -->

##### 目录
- I.概述
- II.Reader/Writer
- III.InputStreamReader/OutputStreamWriter
- IV.FileReader/FileWriter

---
# I.概述

字节流既可以处理二进制文件，也可以处理文本文件。但字节流处理文本文件不太方便，因为：

- 字符有很多种编码方式，但字节流是没有编码概念，编码时不方便处理
- 文本文件的内容都是可显式字符，以字符作为媒介更合理（需要通过特定编码手动进行字节和字符的转化）

因此字符流应运而生。可以说，**字符流就是为了方便处理可显示字符（文本文件）的**。其继承体系如下：

![avatar](https://blog-wocaishiliuke.oss-cn-shanghai.aliyuncs.com/images/JavaSE/io/java_reader_system.jpg)

这里重点介绍常用的：
- Reader/Writer：字符流的抽象基类
- InputStreamReader/OutputStreamWriter：适配器类，将字节流转换为字符流
- FileReader/FileWriter：输入源和输出目标是文件的字符流
- CharArrayReader/CharArrayWriter: 输入源和输出目标是char[]的字符流
- StringReader/StringWriter：输入源和输出目标是String的字符流
- BufferedReader/BufferedWriter：装饰类，对输入输出流提供缓冲，以及按行读写功能
- PrintWriter：装饰类，可将基本类型和对象转换为其字符串形式输出


---
# II.Reader/Writer

**所有字符流的基类。分别定义了字节流最基本的读写方法**。

## 1.Reader

Reader的方法跟InputStream的类似，**区别在于InputStream的读取单位是byte，Reader的读取单位char**。

```java
// 读取一个字符，返回该字符对应的int值，返回-1表示已读到流尾
public int read() throws IOException 
// 读取多个字符，放入字符数组cbuf中，返回实际读入的字符个数 
public int read(char cbuf[]) throws IOException
// 读取len个字节，放入字符数组cbuf中从off开始的位置，返回实际读入的字符个数
abstract public int read(char cbuf[], int off, int len) throws IOException 
// 下一次read()操作是否需要阻塞，如果需要阻塞返回true(类似InputStream.available()）
public boolean ready() throws IOException 
// 跳过n个字符，返回实际跳过的字符个数 
public long skip(long n) throws IOException
// 判断当前字符输入流是否支持mark/reset操作
public boolean markSupported()
// 标记能够从字符输入流中往后读取的字符个数readAheadLimit
public void mark(int readAheadLimit) throws IOException
// 重新从标记位置读取字符
public void reset() throws IOException
// 关闭字符输入流，释放资源
abstract public void close() throws IOException 
```

## 2.Writer

```java
// 写出一个字符
public void write(int c) throws IOException
// 写出字符数组cbuf中的所有字符
public void write(char cbuf[]) throws IOException
// 写出字符数组cbuf中从off开始的len个字符
abstract public void write(char cbuf[], int off, int len) throws IOException
// 写出字符串str中所有的字符
public void write(String str) throws IOException
// 写出字符串str中从off开始的len个字符
public void write(String str, int off, int len) throws IOException
// 向字符输出流中写入一个字符（操作等同于write(int c)）
public Writer append(char c) throws IOException
// 将CharSequence中所有的字符写到字符输出流（操作等同于write(String str)）
public Writer append(CharSequence csq) throws IOException
// 将CharSequence中[start, end)的字符写到字符输出流
public Writer append(CharSequence csq, int start, int end) throws IOException
// 将缓冲而未写出的数据，写出
abstract public void flush() throws IOException
// 关字符输出流，释放资源
abstract public void close() throws IOException 
```


---
# III.InputStreamReader/OutputStreamWriter

**适配器类，负责字节流InputStream/OutputStream和字符流Reader/Writer之间的转换**。

```java
public class InputStreamReader extends Reader
public class OutputStreamWriter extends Writer
```

## 1.OutputStreamWriter

OutputStreamWriter用于将字节输出流OutputStream转换为字符流writer。

例如要将字符串写入一个文本文件中，直接使用FileOutputStream不方便（需要先将字符串通过某种编码转化为字节数组，然后将字节数组写到文件中）。但通过OutputStreamWriter将FileOutputStream转化为Writer后，就可以很方便地直接将字符串写入文件。

> 构造

```java
public OutputStreamWriter(OutputStream out)
public OutputStreamWriter(OutputStream out, Charset cs)
public OutputStreamWriter(OutputStream out, String charsetName)
public OutputStreamWriter(OutputStream out, CharsetEncoder enc)
```

- 第一个参数：out，待适配的字节输出流OutputStream对象
- 第二个参数：将字符转化为字节数组时使用的字符编码集。不传就使用系统默认编码

## 2.InputStreamReader

InputStreamReader用于将字节输入流InputStream转化为Reader，方便通过字符或字符串读取InputStream中的内容。

> 构造

```java
public InputStreamReader(InputStream in)
public InputStreamReader(InputStream in, Charset cs)
public InputStreamReader(InputStream in, String charsetName)
public InputStreamReader(InputStream in, CharsetDecoder dec)
```

- 第一个参数：in，待适配的InputStream对象
- 第二个参数：将字节转化为字符时使用的字符编码集。不传就使用系统默认编码

## 3.示例

将字符串写入文件，并读取打印

```java
@SneakyThrows
public static void main(String[] args) {
    try (OutputStream fos = new FileOutputStream("/home/top/1.txt");
         Writer writer = new OutputStreamWriter(fos, StandardCharsets.UTF_8)) {
        writer.write("hello 白菜饼");
    }

    try (InputStream fis = new FileInputStream("/home/top/1.txt");
         Reader reader = new InputStreamReader(fis, StandardCharsets.UTF_8)) {
        char[] cbuf = new char[1024];
        int count = reader.read(cbuf);
        System.out.println(new String(cbuf, 0, count));
    }
}
```

> 输出

```
hello 白菜饼
```

通过OutputStreamWriter，将FileOutputStream对象转化为Writer实例，然后直接调用Writer的write方法，直接将字符串通过UTF-8编码写入到文件中。然后通过InputStreamReader，将FileInputStream对象转化为Reader实例，然后直接调用Reader的read方法，直接将文件中的二进制内容通过UTF-8编码，读取到字符数组cbuf中，并转化为String打印输出。


---
# IV.FileReader/FileWriter

**FileReader/FileWriter是输入源和输出目标是文件的字符流，文件和内存间的"通道"**。

```java
public class FileReader extends InputStreamReader
public class FileWriter extends OutputStreamWriter
```

## 1.FileWriter

FileWriter可以方便地将字符/字符串写入文件。

功能上，FileWriter和OutputStreamWriter非常类似。不同的是，FileWriter不能指定编码类型，只能使用系统默认编码，而OutputStreamWriter可以指定编码。

> 构造

```java
public FileWriter(File file) throws IOException
public FileWriter(File file, boolean append) throws IOException
public FileWriter(String fileName) throws IOException
public FileWriter(String fileName, boolean append) throws IOException 
```

- 参数file/fileName：输出目标，要写入的文件
- 参数append：表示追加或覆盖文件，true表示追加

该类除构造外，其他方法都继承自OutputStreamWriter。

## 2.FileReader

FileReader可以方便地将文件内容读取为字符/字符串。

功能上，FileReader和InputSreamReader非常类似。不同的是，FileReader也不能指定编码类型，只能使用系统默认编码，而InputStreamReader可以指定编码。

> 构造

```java
public FileReader(File file) throws FileNotFoundException
public FileReader(String fileName) throws FileNotFoundException
```

跟FileWriter类似，FileReader也只定义了构造，其他方法都继承自InputStreamReader。

## 3.示例

```java
@SneakyThrows
public static void main(String[] args) {
    try (Writer writer = new FileWriter("/home/top/1.txt")) {
        writer.write("hello 白菜饼");
    }

    try (Reader reader = new FileReader("/home/top/1.txt")) {
        char[] cbuf = new char[1024];
        int charsRead = reader.read(cbuf);
        System.out.println(new String(cbuf, 0, charsRead));
    }
}
```

> 输出

```
hello 白菜饼
```