---
title: 编码
date: 2018-01-18 00:00:00
categories:
    - JavaSE
tags:
    - JavaSE
---

本文以[字符编码笔记：ASCII，Unicode 和 UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)为基础，记录编码的相关知识。
<!-- more -->

##### 目录
- I.字符集和编码
- II.ASCII字符集
- III.GB*字符集
- IV.Unicode字符集
- V.参考

---

# I.字符集和编码

## 1.字符集

字符（Character）：各种文字、符号的总称，包括各国家文字、标点符号、图形符号、数字等。

字符集（Character set）：字符字典，字符的集合。字符集种类较多，每种字符集包含的字符和个数不同。常见字符集有：ASCII字符集、GB2312字符集、GB18030字符集、Unicode字符集等。

对于计算机来说，不管是内存中还是外部存储上的数据，如文字、图片、视频等，都是以二进制形式存在的。因此需要一种映射规则（字典），把字符映射到某个数字，然后通过特定的规则，将这个数字转化成计算机能够识别的二进制串。其中，字符集就像字典一样，管理着字符到数字的映射。通过字符集，就可以查到某字符在该字符集下对应的数字（码位code point）。将该数字转化成计算机能够识别的二进制串的过程就是编码，编码过程使用的规则就是编码方式。

## 2.编码

编码步骤：
- 先获取字符对应的码位
- 再将码位转成二进制

其中，第二步将码位转成二进制，最简单的方法就是直接把十进制转成二进制。这种方式在单字符集编码中也许好使。但对于变长字符集，计算机不知道应该把多少字节当做一个字符。所以可以肯定的是，**编码肯定不是直接进行二进制转化，必须有特殊的规定，这个规定的目的就是按照一定的规则把码位翻译成二进制串**。

字符集和字符编码一般都是成对出现的，如ASCII、IOS-8859-1、GB2312、GBK、GB18030，既表示了字符集又表示了对应的编码方式。而Unicode比较特殊，Unicode表示字符集，也可以表示编码（通过读查阅一堆资料，我发现Unicode编码的意思其实就是UTF-16编码，比如Java中char使用unicode编码其实就是将char使用UTF-16编码），但是Unicode中不止有一种编码方式，UTF-8、UTF-16、USC、UTF-32都是Unicode字符集的编码方式。


---
# II.ASCII字符集

在早期的计算机系统中，使用的字符非常少，一般只包括26个英文字母、数字符号和一些常用符号。对于这些字符进行编码，使用1个字节就足够了。上世纪60年代，美国制定了一套字符编码，对这些字符和二进制位之间的映射关系，做了统一规定，被称为ASCII码（American Standard Code for Information Interchange），一直沿用至今。

> 二进制bit位取值0或1，8个bit位称为1字节byte，有256种可能的组合，从00000000到11111111。

在早期的计算机系统中，使用的字符非常少，一般只包括26个英文字母、数字符号和一些常用符号。对于这些字符进行编码，使用1个字节就足够了。上世纪60年代，美国制定了一套字符编码，对这些字符和二进制位之间的映射关系，做了统一规定，被称为ASCII码（American Standard Code for Information Interchange），一直沿用至今。

ASCII码是基于拉丁字母的一套编码系统，主要用于显示现代英语和其它西欧语言，是最通用的单字节编码系统。ASCII字符集可以表示128或者256种可能的字符，包含128个字符的ASCII字符集称为标准ASCII码，包含256个字符的ASCII字符集称为扩展ASCII码。

## 1.标准ASCII

标准ASCII码一共规定了128个字符，主要包括大小写字母、阿拉伯数字、标点、预算符号以及一些控制字符。

> 可参考在线[ASCII码对照表](https://tool.oschina.net/commons?type=4)

#### 编码方式

- 0~31、127（共33个）是控制字符或者通信专用字符
    + 控制符如：LF(换行)、CR(回车)、DEL(删除)等
    + 通信专用字符如：SOH(文头)、EOT(文尾)、ACK(确认)等
- 32~126（共95个）
    + 32为空格
    + 48~57为阿拉伯数字
    + 65~90为大写字母
    + 97~122为小写字母
    + 其余为一些标点符号和运算符号！

> 比如空格是32（二进制00100000），大写的字母A是65（二进制01000001）。这128个字符，只占用了一个字节的后7位，最前面的1位统一规定为0，用作奇偶校验。

## 2.扩展ASCII

单字节字符集ASCII，理论上可以表示256个字符，但标准ASCII只表示了128个字符。这是因为标准的ASCII码只使用七位来表示字符，而最高位则是用作奇偶校验的。标准ASCII只能显示26个基本拉丁字母、阿拉伯数目字和英式标点符号，基本上只能应用于现代美国英语，对于其他国家，128个字符肯定不够。比如，在法语中，字母上方有注音符号，此时就无法用标准ASCII码表示。于是，一些欧洲国家决定利用闲置的最高位，即用128-255来映射更多的符号，即扩展ASCII编码（EASCII）。

但不同的国家有不同的字符，这就导致了他们的编码体系中，0-127表示的符号是一样的，但128-255表示的符号各不相同。比如130（二进制10000010）在法语编码中代表了é，在希伯来语编码中却代表了字母Gimel（ג），在俄语编码中又会代表另一个符号。

![avatar](https://blog-wocaishiliuke.oss-cn-shanghai.aliyuncs.com/images/JavaSE/encode/ascii2.jpg)

至于亚洲国家，使用的符号就更多了。1字节8位，只能表示256种符号，肯定是不够的。

#### 编码方式

利用ASCII码闲置的最高位，即0-255都对应字符。EASCII码比ASCII码扩充出来的符号包括表格符号、计算符号、希腊字母和特殊的拉丁符号


---
# III.GB*字符集

单字节的ASCII不适用于亚洲国家。中文拥有10万多汉字，所以必须设计一套字符集，用于将汉字映射为数字。显示中文的常用字符集有：GB2312、GBK、GB18030。比如，简体中文常见的编码方式是GB2312，使用两个字节表示一个汉字，所以理论上最多可以表示256x256=65536个汉字符号。

## 1.GB2312

GB2312，中国国家标准简体中文字符集，全称《信息交换用汉字编码字符集·基本集》，由中国国家标准总局发布，1981年5月1日实施，使用1/2字节变长编码（因为兼容ASCII）。

在GB2312中，GB2312共收录6763个汉字，其中一级汉字3755个，二级汉字3008个，还收录了拉丁字母、希腊字母、日文等682个全角字符。由于GB2312的出现，它基本上解决了我们日常的需要，它所收录的汉字已经覆盖了中国大陆99.75%的使用平率。但是我国文化博大精深，对于人名、古汉语等方面出现的罕用字，GB2312还是不能处理，于是后面的GBK和GB18030汉字字符集出现了。

#### 编码方式

GB2312编码是一种1/2字节变长编码方式，是在ASCII编码的基础上进行扩充的。它规定：
- 1.ASCII的字符完整的包含在GB2312里，编码不变，仍然以0开头。用1个字节来表示1个字符
- 2.ASCII没有的字符，就用1开头来区分。用2个字节表示1个字符。高字节从0xA1到0xF7，低字节从0xA1到0xFE

这样就可以组合出大约7000个简体汉字，还把数学符号、罗马希腊的 字母、日文的假名们都编进去了，连在ASCII里本来就有的数字、标点、字母都统统重新编了两个字节长的编码，这就是常说的"全角"字符，而原来在127以下的那些就叫"半角"字符了。GB2312编码就是将这些码位直接转成8位或16位的二进制串。更多可参考[GB2312简体中文编码表](http://www.knowsky.com/resource/gb2312tbl.htm)。

## 2.GBK

GBK，全称《汉字内码扩展规范》，由中华人民共和国全国信息技术标准化技术委员会1995年12月1日制订，也是汉字编码的标准之一，使用1/2字节变长编码（因为兼容ASCII）。

GBK是GB2312的扩展，它向下与GB2312兼容，向上支持ISO 10646.1国标，是前者向后者过渡中的一个承上启下的标准。

#### 编码方式

GBK编码也是一种1/2字节变长编码方式，跟GB2312一致。GBK字符集编码范围从8140至FEFE（剔除xx7F），首字节在81-FE之间，尾字节在40-FE之间，共23940个码位，共收录了21003个汉字，相比于GB2312，只是表示范围的改变，编码方式是一样的。GBK编码也是将这些码位直接转成8位或16位的二进制串。

## 3.GB18030

GB18030，国家标准GB18030《信息技术 中文编码字符集》，是我国计算机系统必须遵循的基础性标准之一。它有两个版本：GB18030-2000、GB18030-2005。其中GB18030-2000仅规定了常用非汉字符号和27533个汉字（包括部首、部件等）的编码，而GB18030-2005是全文强制性标准，市场上销售的产品必须符合，它是GB18030-2000的基础上增加了42711个汉字和多种我国少数民族文字的编码。GB18030标准采用单字节、双字节和四字节三种方式对字符编码。

#### 编码方式

GB18030编码是一种单字节、双字节和四字节变长编码方式（1/2/4）：
- 单字节部分采用GB/T 11383的编码结构与规则，使用0×00至0×7F码位（对应于ASCII码的相应码位）
- 双字节部分，首字节码位从0×81至0×FE，尾字节码位分别是0×40至0×7E和0×80至0×FE
- 四字节部分，采用GB/T 11383未采用的0×30到0×39作为对双字节编码扩充的后缀，这样扩充的四字节编码，其范围为0×81308130到0×FE39FE39。其中第一、三个字节编码码位均为0×81至0×FE，第二、四个字节编码码位均为0×30至0×39

对于GB18030编码，比较复杂，这里只说明大概。但需要清楚：
- 这也是一个多字节编码方案，有一，二，四字节三种变长组合
- 编码空间很大，高达160万，甚至超过了Unicode规定的110万
- 兼容GB2312、GBK
- 支持许多少数民族如藏、蒙古、彝、维吾尔等的文字

> 在编程中很少使用GB系列编码方式，常用Unicode字符集的一些UTF系列编码。


---
# IV.Unicode字符集

为了适应本国字符，很多国家都设计了一套自己的编码标准，导致存在很多种编码方式，以至于同一个二进制数字可能会被解释成不同的符号。尤其是互联网发展，加速了这一问题的暴露。因此，要想打开一个文本文件，就必须知道它的编码方式，否则使用了错误的编码方式解读，就会出现乱码。电子邮件中经常出现的乱码，就是因为发信人和收信人使用的编码方式不同。为了解决这种不兼容的问题，Unicode（UCS）字符集应时而生。

Unicode是一个很大的字符集合，将世界上所有的符号都纳入其中，每一个符号都对应独一无二的编码，解决了乱码问题。比如，U+0639表示阿拉伯字母Ain，U+0041表示英语大写字母A，U+4E25表示汉字严。Unicode仍在不断增修，迄今已收入超过百万个字符，受到业界认可和广泛使用。具体的符号对应表，可以查询[unicode.org](http://www.unicode.org/)，或者专门的[汉字Unicode编码表](http://www.chi2ko.com/tool/CJK.htm)。

> Unicode带来的问题

**Unicode只是一个字符集（字典），它只规定了符号对应的二进制代码，并没有规定这个二进制代码应该如何存储**。

比如，汉字严的Unicode编码是十六进制数4E25，转换成二进制数足足有15位（100111000100101），也就是说，存储这个符号至少需要2个字节。其他更大的符号，可能需要3字节、4字节，甚至更多。

于是就存在两个问题：
- 1.如何才能区别Unicode和ASCII，计算机怎么知道三个字节该表示一个符号，还是分别表示三个符号呢？
- 2.英文字母只用1字节表示就够了，如果Unicode统一规定，每个符号用3个或4个字节表示，那么每个英文字母前都必然有2到3个字节是0，这对于存储来说是极大的浪费，文本文件的大小也会因此大出二三倍，这是无法接受的。

> 解决

针对上述问题，对Unicode使用了多种编码方式，使用多种不同的二进制格式来表示Unicode，如UTF-8、UTF-16、UTF-32。这点不同于ASCII、GB*字符集。

## Unicode编码方式

ASCII、GB*字符集跟编码方式一一对应，比如使用GBK字符集，就等同于使用GBK编码。但Unicode字符集对应多种编码方式，包括UTF-8、UTF-16、UTF-32。同一个Unicode码位使用不同的编码方式，结果不同。（另外通常说使用Unicode编码时，其实讲的是使用UTF-16编码）

> UTF: UCS Transformation Format。UCS规定了怎么用多个字节表示各种文字符号。至于怎么传输这些编码，是由UTF规定实现的。

码元（Code Unit，也称"代码单元"），是指一个已编码的文本中具有最短比特组合的单元。对于UTF-8来说，码元是8比特长；对于UTF-16来说，码元是16比特长；对于UTF-32来说，码元是32比特长。

#### UTF-32编码

UTF-32是这三种编码方式中最为简单的一种，使用定长4字节编码，一个字符编码过程很简单，只要把该字符的Unicode码位直接转化成32位二进制串即可。

#### UTF-16编码

具体参考[UTF-16](https://zh.wikipedia.org/wiki/UTF-16)和[Java编程拾遗『搞定编码』](http://lidol.top/java/770/)，后续整理。

> Java中的char就是使用的UTF-16编码。

#### UTF-8编码

互联网的普及，强烈要求出现一种统一的编码方式。UTF-8就是在互联网上使用最广的一种Unicode的实现方式。**UTF-8是Unicode的实现方式之一**。

UTF-8是一种针对Unicode的可变长度字符编码方式，可以使用1~4个字节表示一个符号，根据不同的符号而变化字节长度。它可以用来表示Unicode标准中的任何字符，且编码中的第一个字节仍与ASCII兼容，这使得原来处理ASCII字符的系统无须或只须做少部份修改，即可继续使用。因此，它逐渐成为电子邮件、网页及其他存储或传送文字的应用中，优先采用的编码。UTF-8使用1-4字节为每个字符编码，编码规则较简单，只有2条：

- 1.对于单字节符号，第一位设为0，后7位为这个符号的Unicode码。因此对于英语字母，UTF-8和ASCII编码相同
- 2.对于n字节符号（n > 1），第一个字节的前n位都设为1，第n+1位设为0，后面字节的前两位一律设为10。剩下的二进制位，全部为这个符号的Unicode码

转换表如下（字母x表示可用编码的位）：

|字节长度|码位位数|First code point|Last code point|Byte 1|Byte 2|Byte 3|Byte 4|
|:------|:------|:--------------|:--------------|:-----|:-----|:-----|:-----|
|1|7|U+0000|U+007F|0xxxxxxx||||          
|2|11|U+0080|U+07FF|110xxxxx|10xxxxxx|||       
|3|16|U+0800|U+FFFF|1110xxxx|10xxxxxx|10xxxxxx||   
|4|21|U+10000|U+10FFFF|11110xxx|10xxxxxx|10xxxxxx|10xxxxxx|

根据上表，解读UTF-8编码非常简单。如果一个字节的第一位是0，则这个字节就单独表示1个字符；如果第一位是1，则连续有多少个1，就表示当前字符占用多少个字节。

> 以汉字严为例，演示如何实现UTF-8编码：

严的Unicode是4E25（二进制为100 1110 0010 0101），根据上表，可以发现4E25处在第三行的范围内（0000 0800-0000 FFFF），因此严的UTF-8编码需要3个字节，即格式是1110xxxx 10xxxxxx 10xxxxxx。然后从严的最后一个二进制位开始，依次从后向前填入格式中的x，多出的位补0。这样就得到了，严的 UTF-8编码是11100100 10111000 10100101，转换成十六进制就是E4B8A5。

> Unicode与UTF-8之间的转换

通过上一节的例子，可以看到严的Unicode码是4E25，UTF-8编码是E4B8A5。两者不一样，它们可以通过程序进行转换。

Windows平台，有一个最简单的转化方法：使用内置的记事本notepad.exe。打开文件后选择另存为，在弹出的对话框底部有编码选择的下拉框，包含四个选项：ANSI、Unicode、Unicode big endian、UTF-8，保存后完成编码转换。


---
# V.参考

- [字符编码笔记：ASCII，Unicode 和 UTF-8](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)
- [Java编程拾遗『搞定编码』](http://lidol.top/java/770/)