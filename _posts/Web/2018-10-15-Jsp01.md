---
title: Jsp入门
date: 2018-10-15 00:00:00
categories:
    - Servlet
tags:
    - Servlet
    - Java
    - Basic
---

本文介绍Jsp的基本内容

<!-- more -->

##### 目录
+ I.简介
+ II.JSP脚本
+ III.示例
+ IV.EL使用

---

# I.简介

JSP（JavaServer Pages）由Sun Microsystems发布于1999年，用于帮助开发人员，基于HTML、XML等文件类型动态生成页面。类似PHP、ASP，但它基于Java语言。

> - **JSP本质是Servlet，其中支持HTML、JS、JAVA等代码，运行时会被服务器的JSP compiler翻译成Servlet，向客户端输出页面（一般为HTML、XML）**
> - 与在原生servlet中拼接HTML代码相比，JSP更方便、易读、易维护
> - 目前JSP多用于静态页面展示，不建议耦合Java API

- JSP 2.0开始支持EL，JSP 2.1支持Unified Expression Language（和JSF统一的EL版本）（EL，原名SPEL，起源于JSTL，用于访问JSP中的Java Components）
- 另外JSP支持自定义标签库，其中就包括JSTL（JSP Standard Tag Library）。**EL和JSTL的出现就是为了简化JSP的逻辑实现，代替Java代码**

```xml
<%--<%@ page pageEncoding="UTF-8" import="java.util.*" language="java" %>--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
  <head>
    <title>hello jsp</title>
  </head>
  <body>
    hello jsp!
  </body>
</html>
```

# II.JSP脚本

## 脚本声明

用来定义变量、内部类等。编译成Servlet后，相当于类成员

```xml
<%!
    int x = 1;
    class Inner{  
    }
%>
```

## 脚本表达式

常用于输入到页面的内容。被翻译后保存在Servlet的service()中，使用print写到页面

```xml
<%="hello world!"%>
```

## 脚本片段

用于隔断java代码，方便和html代码拼接

```xml
<%
  for (int i = 0; i < 3; i++) {
%>

<h3><%=i %></h3>

<%
  }
%>
```

# III.示例

```
study-web/study-jsp$ tree
.
├── src
├── study-jsp.iml
└── web
    ├── index.jsp
    └── WEB-INF
        ├── classes
        ├── lib
        │   └── javax.servlet-api-4.0.1.jar
        └── web.xml
```

> 这里不导Servlet包也可以（Tomcat有）

```xml
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
  <head>
    <title>hello jsp</title>
  </head>
  <body>
    hello jsp!
    <br/>

    <%-- 脚本声明 --%>
    <%!
      int x = 1;
      String s ="test";
      class Inner {}
    %>

    <%-- 脚本片段 --%>
    <%
        request.setAttribute("key", "测试中文1");
    %>

    <%-- 脚本表达式 --%>
    <%="哈哈哈1"%><br/>
    <%=x %><br/>
    <%=s.substring(0,3) %><br/>
    <%=true %><br/>
    <%=request.getAttribute("key") %><br/>

    <%-- 脚本片段和脚本表达式混用 --%>
    <%
      for (int i = 0; i < 3; i++) {
    %>
    <h3><%=i %></h3>
    <%
      }
    %>
  </body>
</html>
```

> **第一次访问JSP时，会将其翻译成java文件，并编译成class文件**

```
~/.IntelliJIdea2018.2/system/tomcat/Unnamed_study-web_6/work/Catalina/localhost/ROOT/org/apache/jsp$ tree
.
├── index_jsp.class
├── index_jsp$Inner.class
└── index_jsp.java
```

- index_jsp.java

> - 1.其中HttpJspBase继承了HttpServlet、实现了HttpJspPage
> - 2.该Servlet中也有init、service、destroy生命周期方法，其中service中进行HTML拼接和输出

```java
/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/9.0.12
 * Generated at: 2018-11-27 08:12:46 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class index_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {


      int x = 1;
      String s ="test";
      class Inner {

      }
    
  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = null;
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    if (!javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      final java.lang.String _jspx_method = request.getMethod();
      if ("OPTIONS".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        return;
      }
      if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
        return;
      }
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
                null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\n");
      out.write("\n");
      out.write("<html>\n");
      out.write("  <head>\n");
      out.write("    <title>hello jsp</title>\n");
      out.write("  </head>\n");
      out.write("  <body>\n");
      out.write("    hello jsp!\n");
      out.write("    <br/>\n");
      out.write("\n");
      out.write("    ");
      out.write("\n");
      out.write("\n");
      out.write("    ");

        request.setAttribute("key", "测试中文1");
    
      out.write("\n");
      out.write("\n");
      out.write("    ");
      out.print("哈哈哈1");
      out.write("<br/>\n");
      out.write("    ");
      out.print(x );
      out.write("<br/>\n");
      out.write("    ");
      out.print(s.substring(0,3) );
      out.write("<br/>\n");
      out.write("    ");
      out.print(true );
      out.write("<br/>\n");
      out.write("    ");
      out.print(request.getAttribute("key") );
      out.write("<br/>\n");
      out.write("\n");
      out.write("    ");

      for (int i = 0; i < 3; i++) {
    
      out.write("\n");
      out.write("\n");
      out.write("    <h3>");
      out.print(i );
      out.write("</h3>\n");
      out.write("\n");
      out.write("    ");

      }
    
      out.write("\n");
      out.write("  </body>\n");
      out.write("</html>\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
```

# IV.EL使用

EL表达式，可以方便地从容器（page、request、session、ServletContext）中取出数据，替代<%= %>脚本表达式，简化JSP代码

```
${容器Scope.属性名}
```

```
<% request.setAttribute("key", "测试中文1"); %>

<%-- EL表达式 --%>
EL: ${requestScope.key}
```

#### EL和脚本表达式区别

当取不到值时，脚本表达式返回null，EL表达式返回空""

```xml
<%
    request.setAttribute("key", "测试中文1");
    request.setAttribute("key2", "");
%>

<%-- 取不到值时，脚本表达式和EL的区别 --%>
脚本表达式：<%=request.getAttribute("y") %><br/>
EL：${requestScope.y}

empty？：${empty requestScope.key}<br/>
==null？：${requestScope.key == null}<br/>
empty？：${empty requestScope.key2}<br/>
==null？：${requestScope.key2 == null}<br/>
```