---
title: Shiro入门（一）
date: 2018-07-01 19:01:09
categories:
    - Shiro
tags:
    - Shiro
    - Basic
    - Java
---

Shiro是Apache的一款开源安全框架，提供认证、鉴权、会话管理、加密等，强大而易用。本文将介绍其入门的基本知识。

<!-- more -->

##### 目录
+ I.概念
+ II.helloworld

---

与Spring Security相比

- shiro概念简单、灵活易用，但不失强大
- shiro可脱离Spring
- shiro权限控制粒度较粗

> Spring官网也是使用shiro做安全管理的

# I.概念

Shiro架构中有3个基本概念：Subject、SecurityManager、Realms

![avatar](http://blog-wocaishiliuke.oss-cn-shanghai.aliyuncs.com/images/Shiro/Shiro-Basic-Architecture.png)

#### 1.Subject

> 因为User这个类名已经烂大街了，Shiro选择了Subject

代表当前用户。可以是人、三方服务、后台账户、定时任务等。所有Subject都要绑定到SecurityManager上，与Subject的交互被转换为和SecurityManager进行交互

> 当和Subject交互时，底层是SecurityManager在为各个Subject提供安全相关的操作

#### 2.SecurityManager

Shiro架构的核心。管理和协调着内部各组件。Shiro中的SecurityManager默认实现（DefaultSecurityManager）包含以下功能：

```
Authentication
Authorization
Session Management
Cache Management
Realm coordination
Event propagation
“Remember Me” Services
Subject creation
Logout and more
```

每个组件有很多功能，并且在一个SecurityManager实现类中平滑地协调各组件是很困难的，所以SecurityManager采用了模块化设计。其各种实现类代理着对应组件的功能，相当于组件容器。SecurityManager实现类和组件都是Java Bean，通过getter和setter可以方便地进行配置，也便于同Spring、Guice等集成

![avatar](http://blog-wocaishiliuke.oss-cn-shanghai.aliyuncs.com/images/Shiro/SecurityManage-hierarchy.png)

> 一旦SecurityManager和其组件配置完成，就无需再关注该部分，开发者使用更多的是Subject的API

#### 3.Realms

Realm是Shiro和安全数据间的桥梁和连接器，相当于安全DAO，囊括了安全数据源的连接信息，提供认证和授权所需的数据，所以配置Shiro时至少指定一个Realm。同其他组件一样，SecurityManager也管理着Realm如果操作安全数据源。

> Shiro自身提供了多种Realm，JDBC、文件（ini、properties）等，也可以配置自定义Realm

#### 4.架构

![avatar](http://blog-wocaishiliuke.oss-cn-shanghai.aliyuncs.com/images/Shiro/Shiro-Architecture.png)

- 上层是各种Subject，通过SecurityManager，调用各组件进行安全操作，如认证、鉴权等。Realm负责获取安全数据源
- 图中也描述了Shiro的Session管理、加密等其他功能
- 其他组件：认证器、授权器、会话管理器，缓存管理器等

#### 5.认证器

Authenticator组件负责认证逻辑，和一个或多个Realm协作完成用户验证。配置多个Realm时，需要AuthenticationStrategy来协调各Realm间的决策

#### 6.授权器

Authorizer负责鉴权。同样当有多个后端权限数据源时，它也会作出协调，决定用户最终能否访问

#### 7.会话管理器

SessionManager负责创建和管理用户会话的生命周期，为用户（Subject）提供稳定的会话体验。在众多安全框架中，唯独Shiro能在没有Web/Servlet/EJB容器环境下，仍可以提供本地化用户会话管理。默认情况下Shiro使用已存在的Session机制（如Servlet Container），当是独立或非Web环境时，Shiro使用内置的企业级Session管理，而对于开发者来说，编程方式同web环境一样。另外，SessionDAO代表着SessionManager完成Session的持久化操作（CRUD）

#### 8.缓存管理

CacheManager创建和管理着Cache实例的生命周期。对用于认证、授权、会话管理等的后端安全数据源进行缓存，可以提升框架性能。Shiro支持集成任何流行的开源缓存产品

#### 9.加密

Cryptography是企业级安全框架的必需，Shiro的crypto包中提供了方便使用和理解的crytographic Ciphers、Hashes（也就是digests）和不同的解码实现。与复杂的Java原生cryptography支持相比，Shiro的crypto API更简单易用


---


# II.helloworld