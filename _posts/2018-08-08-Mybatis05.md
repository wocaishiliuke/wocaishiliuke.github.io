---
title: Mybatis映射文件（二）
date: 2018-08-08 20:01:09
categories:
    - Mybatis
tags:
    - Mybatis
    - Basic
    - Java
---

本文将在[Mybatis映射文件（一）](https://wocaishiliuke.github.io/mybatis/2018/08/07/Mybatis04/)的基础上进一步探讨，包括动态SQL和resultMap等

<!-- more -->

##### 目录
+ I.动态SQL
+ II.resultMap
+ III.参考

---

# I.动态SQL

> 动态SQL是mybatis的强大特性之一，解决了其他框架拼接SQL的复杂度。MyBatis3又精简了元素种类，采用基于OGNL的表达式淘汰了大部分元素，完成动态生成SQL的功能。

#### 1.if

> - if的test属性支持OGNL表达式和简单的Java代码
> - 判断中的参数取值同样与_parameter有关，参考[Mybatis映射文件（1）](https://wocaishiliuke.github.io/mybatis/2018/08/07/Mybatis04/)中的传参接参部分

```
//单个参数+不使用@Param，要用_parameter判断
public List<User> queryUserIf(String sex);

<select id="queryUserIf" resultType="User">
    select * from tb_user where 1 = 1
    <if test="_parameter != null and _parameter != ''">
        AND sex = #{sex}
    </if>
</select>
```

```
//多个参数或使用@Param，要到_parameter这个ParamMap中取参进行判断
public List<User> queryUserAnnoIf(@Param("sex") String sex);

<select id="queryUserAnnoIf" resultType="User">
    select * from tb_user where 1 = 1
    <!-- <if test="param1 != null and param1.trim() != ''"> -->
    <!-- <if test="sex != null and sex.trim() != ''"> -->
    <!-- 简单的Java代码也可以 -->
    <if test="sex != null &amp;&amp; !''.equals(sex.trim()) ">
        AND sex = #{sex}
    </if>
</select>
```

> - &在XML中是非法字符，要用&amp;转义代替
> - 这里使用1=1规避了where的尴尬，实际中不推荐，稍后使用where标签解决
> - 动态SQL判断中的取参，如上例所示，具体参考Mybatis映射文件（1）即可，后面不再详述。

#### 2.choose、when、otherwise

> - 与if一样做判断使用，但区别在于只能从中择其一项，类似Java中的switch语句
> - 适用多选一的情况。注意书写顺序（条件优先级），因为只会匹配一个条件

```
public List<User> queryUserChoose(@Param("sex") String sex, @Param("password") String password);

<select id="queryUserChoose" resultType="User">
    select * from tb_user where 1 = 1
    <choose>
        <when test="sex != null and sex.trim() != ''">AND sex = #{sex}</when>
        <when test="password != null and password.trim() != ''">AND password = #{sex}</when>
        <otherwise>AND age = 22</otherwise>
    </choose>
</select>
```

#### 3.where、set、trim

###### where

> 智能的添加WHERE关键字

```
<!-- 如果不满足条件，就会多个where，报错 -->
<select id="queryUserWithoutWhere" resultType="User">
    select * from tb_user where
    <if test="sex != null and sex.trim() != ''">
        sex = #{sex}
    </if>
</select>
```

```
public List<User> queryUserWhere(@Param("sex") String sex);

<select id="queryUserWhere" resultType="User">
    select * from tb_user
    <where>
        <if test="sex != null and sex.trim() != ''">
            AND sex = #{sex}
        </if>
    </where>
</select>
```

###### set

###### trim

#### 4.foreach

---

# II.resultMap

---

# III.参考